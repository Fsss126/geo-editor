(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{164:function(e,a,t){e.exports=t(464)},169:function(e,a,t){},248:function(e,a){},252:function(e,a){},464:function(e,a,t){"use strict";t.r(a);var r=t(0),l=t.n(r),i=t(28),n=t.n(i),o=(t(169),t(163)),s=t(29),c=t(30),d=t(32),p=t(31),m=t(33),u=t(4),y=t.n(u),f=t(50),v=t.n(f),h=t(155),b=t.n(h),g=t(156),w=t.n(g),E=t(157),k=t.n(E),L=t(158),C=t.n(L),N=t(159),A=t.n(N),j=t(160),O=t(7),P=t.n(O),U=(t(287),t(161)),S=t.n(U),D=t(51),x=t(162),F={circle:{"circle-color":"color","circle-radius":"number","circle-opacity":"number"},line:{stroke:"color","stroke-width":"number","stroke-opacity":"number"},polygon:{stroke:"color","stroke-width":"number","stroke-opacity":"number",fill:"color","fill-opacity":"number"}};function B(e){return l.a.createElement("span",{className:e.className?"btn "+e.className:"btn","data-balloon":e.tooltipData,"data-balloon-pos":e.tooltipPos,onClick:e.callback},e.children)}y.a.fn.hasAncestor=function(e){return 1===y()(this).parents(e).length};var I=function(e){function a(){var e,t;Object(s.a)(this,a);for(var r=arguments.length,l=new Array(r),i=0;i<r;i++)l[i]=arguments[i];return(t=Object(d.a)(this,(e=Object(p.a)(a)).call.apply(e,[this].concat(l)))).switchVisibility=function(){t.props.layer.visible=!t.props.layer.visible,t.props.setVisibility(t.props.layer,t.props.layer.visible),t.forceUpdate()},t.select=function(e){y()(e.target).hasAncestor(".btn")||y()(e.target).hasClass("btn")||t.props.selectCallback(t.props.layer)},t}return Object(m.a)(a,e),Object(c.a)(a,[{key:"render",value:function(){var e=this,a=function(a){return function(){e.props.downloadCallback(e.props.layer,a)}};return this.props.layer.editing?l.a.createElement("div",{className:"row layer editing",onClick:this.select},l.a.createElement("div",{className:"col"},l.a.createElement(B,{className:"visibility-btn",tooltipData:this.props.layer.visible?"Hide layer":"Show layer",tooltipPos:"right",callback:this.switchVisibility},l.a.createElement("i",{className:"material-icons"},this.props.layer.visible?"visibility":"visibility_off")),l.a.createElement("input",{value:this.props.layer.name,onChange:function(a){e.props.layer.name=a.target.value,e.forceUpdate()}})),l.a.createElement("div",{className:"col-auto control-btns"},l.a.createElement("span",{className:"mode"},"editing"),l.a.createElement(B,{tooltipData:"Save changes",tooltipPos:"left",callback:function(){e.props.saveChanges(e.props.layer)}},l.a.createElement("i",{className:"material-icons"},"done")),l.a.createElement(B,{tooltipData:"Cancel",tooltipPos:"left",callback:function(){e.props.discardChanges(e.props.layer)}},l.a.createElement("i",{className:"material-icons"},"close")))):l.a.createElement("div",{className:"row layer",onClick:this.select},l.a.createElement("div",{className:"col"},l.a.createElement(B,{className:"visibility-btn",tooltipData:this.props.layer.visible?"Hide layer":"Show layer",tooltipPos:"right",callback:this.switchVisibility},l.a.createElement("i",{className:"material-icons"},this.props.layer.visible?"visibility":"visibility_off")),l.a.createElement("span",{className:"title"},this.props.layer.name)),l.a.createElement("div",{className:"col-auto control-btns"},this.props.selected?l.a.createElement("span",{className:"mode"}):"",l.a.createElement(B,{tooltipData:"Navigate to layer",tooltipPos:"left",callback:function(){e.props.layer.data.features.length>0&&(console.log("fly to"),e.props.map.fitBounds(j.bbox(e.props.layer.data),{animate:!0,padding:15,duration:500}))}},l.a.createElement("i",{className:"material-icons"},"location_searching")),l.a.createElement(B,{tooltipData:"Edit layer",tooltipPos:"left",callback:function(){e.props.editCallback(e.props.layer)}},l.a.createElement("i",{className:"material-icons"},"edit")),l.a.createElement(B,{tooltipData:"Edit layer",tooltipPos:"left",callback:function(){e.props.deleteCallback(e.props.layer)}},l.a.createElement("i",{className:"material-icons"},"delete")),l.a.createElement(B,{className:"dropdown-btn",tooltipData:"Download as file",tooltipPos:"left",callback:function(e){y()(e.target).hasAncestor(".dropdown")||(y()(".show-dropdown").removeClass("show-dropdown"),y()(e.currentTarget).toggleClass("show-dropdown"))}},l.a.createElement("i",{className:"fas fa-file-download"}),l.a.createElement("div",{className:"dropdown"},"Download as",l.a.createElement("div",{onClick:a("geojson")},"GeoJSON"),l.a.createElement("div",{onClick:a("kml")},"KML"),l.a.createElement("div",{onClick:a("zip")},"Shapefile")))))}}]),a}(r.Component),M=Object(D.SortableElement)(function(e){return l.a.createElement(I,e)}),J=Object(D.SortableContainer)(function(e){return l.a.createElement("div",{className:e.editedLayer?"layers container-fluid editing":"layers container-fluid"},e.layers.map(function(a,t){return l.a.createElement(M,Object.assign({key:"item-".concat(t),index:t},Object(o.a)({},e.layerCallbacks,{map:e.map,layer:a,selected:e.selectedLayer?a.id===e.selectedLayer.id:null})))}))}),V=function(e){function a(){var e,t;Object(s.a)(this,a);for(var r=arguments.length,l=new Array(r),i=0;i<r;i++)l[i]=arguments[i];return(t=Object(d.a)(this,(e=Object(p.a)(a)).call.apply(e,[this].concat(l)))).state={visible:!1},t.onChange=function(e){t.props.onChange({target:{name:t.props.name,value:e.hex}})},t}return Object(m.a)(a,e),Object(c.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"color-preview",onClick:function(a){y()(a.target).hasClass("color-preview")&&e.setState(function(e){return{visible:!e.visible}})},style:{background:this.props.color?this.props.color:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==) left center"}},l.a.createElement("div",{className:this.state.visible?"picker visible":"picker"},l.a.createElement(x.ChromePicker,{color:this.props.color,onChange:this.onChange})))}}]),a}(r.Component),R=function(e){function a(e){var t;return Object(s.a)(this,a),(t=Object(d.a)(this,Object(p.a)(a).call(this,e))).onChange=function(e){t.feature.properties[e.target.name]=e.target.value,t.forceUpdate()},t.saveChanges=function(){var e=P.a.find(t.props.layers,function(e){return e.id===t.props.feature.source});console.log(e,t.feature.geometry);var a=P.a.find(e.data.features,function(e){return e.id===t.feature.id});console.log(a),a.properties=t.feature.properties,t.props.map.getSource(e.id).setData(e.data)},t.feature=null,t}return Object(m.a)(a,e),Object(c.a)(a,[{key:"componentDidUpdate",value:function(e){e.feature!==this.props.feature&&(console.log("change feature"),this.feature=this.props.feature,this.forceUpdate())}},{key:"render",value:function(){var e=this;console.log(this.feature);var a=this.feature;if(!a)return l.a.createElement("div",{className:"feature-properties-popup"});var t=null;switch(a.geometry.type){case"Polygon":case"MultiPolygon":t="polygon";break;case"Point":case"MultiPoint":t="circle";break;case"LineString":case"MultiLineString":t="line"}console.log(a.properties);var r=F[t],i=function(a){return function(){delete e.feature.properties[a],e.forceUpdate()}};return l.a.createElement("div",{className:a?"feature-properties-popup visible container":"feature-properties-popup container"},l.a.createElement(B,{className:"close-btn",callback:this.props.close},l.a.createElement("i",{className:"material-icons"},"close")),P.a.map(r,function(t,r){return l.a.createElement("div",{className:"row",key:r},l.a.createElement("div",{className:"col"},l.a.createElement("span",null,r),l.a.createElement("i",{className:"material-icons remove-btn",onClick:i(r)},"remove")),l.a.createElement("div",{className:"col"},"color"===t?l.a.createElement(V,{color:a.properties[r]?a.properties[r]:"",name:r,onChange:e.onChange}):l.a.createElement("input",{name:r,type:t,value:a.properties[r]?a.properties[r]:"",onChange:e.onChange})))}),P.a.reduce(a.properties,function(a,t,n){return-1===P.a.indexOf(P.a.keysIn(r),n)&&a.push(l.a.createElement("div",{className:"row",key:n},l.a.createElement("div",{className:"col"},l.a.createElement("span",null,n),l.a.createElement("i",{className:"material-icons remove-btn",onClick:i(n)},"remove")),l.a.createElement("div",{className:"col"},l.a.createElement("input",{name:n,type:"text",value:t,onChange:e.onChange})))),a},[]),l.a.createElement("div",{className:"row d-flex justify-content-center"},l.a.createElement("div",{className:"col-auto"},l.a.createElement("div",{className:"text-btn",onClick:this.saveChanges},"Save"))))}}]),a}(r.Component),z=function(e){function a(e){var t;return Object(s.a)(this,a),(t=Object(d.a)(this,Object(p.a)(a).call(this,e))).setLayerVisibility=function(e,a){console.log(e,a),a?(t.map.setLayoutProperty(e.id+"fill","visibility","visible"),t.map.setLayoutProperty(e.id+"fill-stroke","visibility","visible"),t.map.setLayoutProperty(e.id+"circle","visibility","visible"),t.map.setLayoutProperty(e.id+"line","visibility","visible")):(t.map.setLayoutProperty(e.id+"fill","visibility","none"),t.map.setLayoutProperty(e.id+"fill-stroke","visibility","none"),t.map.setLayoutProperty(e.id+"circle","visibility","none"),t.map.setLayoutProperty(e.id+"line","visibility","none"))},t.removeLayer=function(e){t.map.removeLayer(e.id+"fill"),t.map.removeLayer(e.id+"fill-stroke"),t.map.removeLayer(e.id+"circle"),t.map.removeLayer(e.id+"line"),t.map.removeSource(e.id),P.a.remove(t.layers,function(a){return a.id===e.id}),t.forceUpdate()},t.editLayer=function(e){t.editedLayer=t.selectedLayer=P.a.cloneDeep(e),e.editing=!0,t.selectedLayer=e,t.draw?t.draw.set(e.data):(t.draw=new b.a,t.map.addControl(t.draw),t.map.on("draw.create",t.updateLayer),t.map.on("draw.update",t.updateLayer),t.draw.add(e.data)),t.setLayerVisibility(e,!1),t.forceUpdate()},t.updateLayer=function(){t.selectedLayer.data=t.draw.getAll(),t.forceUpdate()},t.saveChanges=function(e){e.editing=!1,t.map.getSource(e.id).setData(t.assignIds(e.data)),t.map.off("draw.create",t.updateLayer),t.map.off("draw.update",t.updateLayer),t.map.removeControl(t.draw),t.draw=null,t.editedLayer=null,t.setLayerVisibility(e,!0),t.forceUpdate()},t.assignIds=function(e){return P.a.each(e.features,function(e,a){e.id=a}),console.log(e),e},t.discardChanges=function(e){e.editing=!1,e.name=t.editedLayer.name,e.data=t.editedLayer.data,t.map.off("draw.create",t.updateLayer),t.map.off("draw.update",t.updateLayer),t.map.removeControl(t.draw),t.draw=null,t.editedLayer=null,t.setLayerVisibility(e,!0),t.forceUpdate()},t.addLayer=function(e,a){t.assignIds(e);var r=t.layersIndex.toString();t.map.addSource(r,{type:"geojson",data:e}),t.map.addLayer({id:r+"fill",type:"fill",source:r,paint:{"fill-color":["coalesce",["get","fill"],["get","fill-color"],"#088"],"fill-opacity":["coalesce",["get","fill-opacity"],.7]},filter:["in","$type","Polygon"]}),t.map.addLayer({id:r+"fill-stroke",type:"line",source:r,paint:{"line-color":["coalesce",["get","stroke"],["get","stroke-color"]],"line-width":["coalesce",["get","stroke-width"],0],"line-opacity":["coalesce",["get","stroke-opacity"],0]},filter:["in","$type","Polygon"]}),t.map.addLayer({id:r+"circle",type:"circle",source:r,paint:{"circle-radius":["coalesce",["get","circle-radius"],3],"circle-color":["coalesce",["get","circle-color"],"#088"],"circle-opacity":["coalesce",["get","circle-opacity"],1]},filter:["in","$type","Point"]}),t.map.addLayer({id:r+"line",type:"line",source:r,layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":2,"line-color":"#088"},filter:["in","$type","LineString"]}),t.layers.push({name:a,id:r,data:e,visible:!0,editing:!1}),t.layersIndex++,t.forceUpdate()},t.fileDownload=function(e,a){var r,l;if("geojson"===a)r=JSON.stringify(e.data),l=new Blob([r],{type:"application/json"});else{if("zip"===a){r=A.a.zip(e.data);var i=document.getElementById("download-link");i.download=e.name+"."+a,i.href="data:application/zip;base64,"+r;var n=new MouseEvent("click");return void i.dispatchEvent(n)}"kml"===a&&(r=C()(e.data),l=new Blob([r],{type:"text/xml"}))}null!==t.downloadFile&&window.URL.revokeObjectURL(t.downloadFile),t.downloadFile=window.URL.createObjectURL(l);var o=document.getElementById("download-link");o.download=e.name+"."+a,o.href=t.downloadFile,window.requestAnimationFrame(function(){var e=new MouseEvent("click");o.dispatchEvent(e)})},t.fileUpload=function(e){for(var a,r=e.target,l=function(e,a){var r=a.name.split(".").pop();if("zip"===r){var l=new FileReader;l.onload=function(e){w()(e.target.result).then(function(e){t.addLayer(e,a.name.substr(0,a.name.length-r.length-1))})},l.readAsArrayBuffer(a)}else if("kml"===r){var i=new FileReader;i.onload=function(e){var l=(new DOMParser).parseFromString(e.target.result,"text/xml"),i=k.a.kml(l);t.addLayer(i,a.name.substr(0,a.name.length-r.length-1))},i.readAsText(a)}else if("geojson"===r){var n=new FileReader;n.onload=function(e){var l=JSON.parse(e.target.result);t.addLayer(l,a.name.substr(0,a.name.length-r.length-1))},n.readAsText(a)}},i=0;a=r.files[i];i++)l(0,a)},t.selectLayer=function(e){console.log(e.data),t.selectedLayer=e,t.forceUpdate()},t.onSortEnd=function(e){var a=e.oldIndex,r=e.newIndex,l=t.layers[a].id,i=r===t.layers.length-1?void 0:t.layers[r].id+"fill";console.log(a,r,t.layers[a],t.layers[r]),t.map.moveLayer(l+"fill",i),t.map.moveLayer(l+"fill-stroke",i),t.map.moveLayer(l+"circle",i),t.map.moveLayer(l+"line",i),t.layers=Object(D.arrayMove)(t.layers,a,r),t.forceUpdate()},t.closePopup=function(){t.selectedFeature=null,t.forceUpdate()},t.layers=[],t.layersIndex=0,t.map=null,t.draw=null,t.downloadFile=null,t.selectedLayer=null,t.editedLayer=null,t.selectedFeature=null,t}return Object(m.a)(a,e),Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;v.a.accessToken="pk.eyJ1IjoiYmJhbGJhdHJvc3MiLCJhIjoiY2pub2RwanMwMmdoZjNrb3NuMzhvZXAzOCJ9.F8VzBUbUv6_NOVZgcWrhqQ";var a=new v.a.Map({container:"map",style:"mapbox://styles/mapbox/streets-v9"});a.addControl(new v.a.NavigationControl),a.on("load",function(){}),a.on("contextmenu",function(t){var r=e.layers.map(function(e){return e.id}),l=e.map.queryRenderedFeatures(t.point,{layers:P.a.reduce(e.map.getStyle().layers,function(e,a){return-1!==P.a.indexOf(r,a.source)&&e.push(a.id),e},[])})[0];l&&(a.getCanvas().style.cursor="pointer",e.selectedFeature=l,e.forceUpdate())}),this.map=a,y()(".controls").click(function(e){y()(e.target).hasAncestor(".dropdown-btn")||y()(e.target).hasClass("dropdown-btn")||y()(".show-dropdown").removeClass("show-dropdown")})}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"container-fluid"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{id:"map",className:"col-8"},l.a.createElement(R,{feature:this.selectedFeature,map:this.map,layers:this.layers,ref:"featurePopup",close:this.closePopup})),l.a.createElement("div",{className:"col-4 controls"},l.a.createElement("div",{className:"header"},l.a.createElement("span",{className:"title"},"Preview"),l.a.createElement("div",{className:"preview-box",dangerouslySetInnerHTML:{__html:this.selectedLayer?S()(this.selectedLayer.data).render():""}})),l.a.createElement("div",{className:"header"},l.a.createElement("span",{className:"title"},"Layers"),l.a.createElement("input",{name:"file-input",id:"file-input",onChange:this.fileUpload,type:"file",hidden:!0}),l.a.createElement("a",{id:"download-link",href:"./"},"Download"),l.a.createElement(B,{tooltipData:"Add from file",tooltipPos:"down",callback:function(){y()("#file-input").click()}},l.a.createElement("i",{className:"fas fa-file-upload"})),l.a.createElement(B,{tooltipData:"Add new empty layer",tooltipPos:"down",callback:function(){e.addLayer({type:"FeatureCollection",features:[]},"New layer")}},l.a.createElement("i",{className:"material-icons add-layer-btn"},"library_add"))),l.a.createElement(J,{pressDelay:400,map:this.map,layers:this.layers,editedLayer:this.editedLayer,selectedLayer:this.selectedLayer,layerCallbacks:{downloadCallback:this.fileDownload,editCallback:this.editLayer,selectCallback:this.selectLayer,setVisibility:this.setLayerVisibility,saveChanges:this.saveChanges,discardChanges:this.discardChanges,deleteCallback:this.removeLayer},onSortEnd:this.onSortEnd}))))}}]),a}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n.a.render(l.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[164,2,1]]]);
//# sourceMappingURL=main.b8bf5728.chunk.js.map