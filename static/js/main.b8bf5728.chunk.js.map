{"version":3,"sources":["App.js","serviceWorker.js","index.js"],"names":["FEATURE_PROPERTIES","circle","circle-color","circle-radius","circle-opacity","line","stroke","stroke-width","stroke-opacity","polygon","fill","fill-opacity","Button","props","react_default","a","createElement","className","data-balloon","tooltipData","data-balloon-pos","tooltipPos","onClick","callback","children","$","fn","hasAncestor","this","parents","length","LayerControl","switchVisibility","_this","layer","visible","setVisibility","forceUpdate","select","e","target","hasClass","selectCallback","_this2","getDownloadCallback","extension","downloadCallback","editing","value","name","onChange","saveChanges","discardChanges","selected","data","features","console","log","map","fitBounds","turf","animate","padding","duration","editCallback","deleteCallback","removeClass","currentTarget","toggleClass","Component","SortableLayer","SortableElement","App_LayerControl","LayersList","SortableContainer","editedLayer","layers","index","Object","assign","key","concat","objectSpread","layerCallbacks","selectedLayer","id","ColorPicker","state","color","_this3","hex","_this4","event","setState","prevState","style","background","react_color_lib","FeaturePropertiesPopup","_this5","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","feature","properties","featureLayer","_","find","source","geometry","sourceFeature","getSource","setData","prevProps","_this6","featureType","type","removeProp","close","App_ColorPicker","reduce","result","indexOf","keysIn","push","App","_this7","setLayerVisibility","visibility","setLayoutProperty","removeLayer","removeSource","remove","l","editLayer","cloneDeep","draw","set","MapboxDraw","addControl","on","updateLayer","add","getAll","assignIds","off","removeControl","each","i","addLayer","geojson","layersIndex","toString","addSource","paint","fill-color","filter","line-color","line-width","line-opacity","layout","line-join","line-cap","fileDownload","content","JSON","stringify","Blob","shpwrite","zip","link","document","getElementById","download","href","MouseEvent","dispatchEvent","tokml","downloadFile","window","URL","revokeObjectURL","createObjectURL","requestAnimationFrame","fileUpload","file","input","_loop","split","pop","reader","FileReader","onload","shp","then","substr","readAsArrayBuffer","dom","DOMParser","parseFromString","toGeoJSON","kml","readAsText","parse","files","selectLayer","onSortEnd","_ref","oldIndex","newIndex","beforeLayer","undefined","moveLayer","arrayMove","closePopup","selectedFeature","_this8","mapboxgl","accessToken","Map","container","NavigationControl","layersIds","queryRenderedFeatures","point","getStyle","getCanvas","cursor","click","_this9","App_FeaturePropertiesPopup","ref","dangerouslySetInnerHTML","__html","geojson2svg","render","hidden","pressDelay","Boolean","location","hostname","match","ReactDOM","src_App","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.b8bf5728.chunk.js","sourcesContent":["import React, {Component} from 'react';\nimport $ from 'jquery';\nimport mapboxgl from 'mapbox-gl';\nimport MapboxDraw from '@mapbox/mapbox-gl-draw';\nimport shp from 'shpjs';\nimport toGeoJSON from '@mapbox/togeojson';\nimport tokml from 'tokml';\nimport shpwrite from 'shp-write';\nimport * as turf from '@turf/turf';\nimport _ from 'lodash';\nimport '@mapbox/mapbox-gl-draw/dist/mapbox-gl-draw.css';\nimport geojson2svg from 'geojson-to-svg';\nimport {SortableContainer, SortableElement, arrayMove} from 'react-sortable-hoc';\nimport { ChromePicker } from 'react-color';\n\nconst FEATURE_PROPERTIES = {\n    circle: {\n        \"circle-color\": \"color\",\n        \"circle-radius\": \"number\",\n        \"circle-opacity\": \"number\"\n    },\n    line: {\n        \"stroke\": \"color\",\n        \"stroke-width\": \"number\",\n        \"stroke-opacity\": \"number\"\n    },\n    polygon: {\n        \"stroke\": \"color\",\n        \"stroke-width\": \"number\",\n        \"stroke-opacity\": \"number\",\n        \"fill\": \"color\",\n        \"fill-opacity\": \"number\"\n    }\n};\n\n$.fn.hasAncestor = function(a) {\n    return $(this).parents(a).length === 1;\n};\n\nfunction Button(props) {\n    return (\n        <span className={props.className ? \"btn \" + props.className : \"btn\"}\n              data-balloon={props.tooltipData}\n              data-balloon-pos={props.tooltipPos}\n              onClick={props.callback}>\n            {props.children}\n        </span>\n    );\n}\n\nclass LayerControl extends Component {\n    switchVisibility = () => {\n        this.props.layer.visible = !this.props.layer.visible;\n        this.props.setVisibility(this.props.layer, this.props.layer.visible);\n        this.forceUpdate();\n    };\n\n    select = (e) => {\n        if (!($(e.target).hasAncestor('.btn') || $(e.target).hasClass('btn')))\n        {\n            this.props.selectCallback(this.props.layer);\n        }\n    };\n\n    render() {\n        let getDownloadCallback = (extension) => {\n            return () => {\n                this.props.downloadCallback(this.props.layer, extension);\n            }\n        };\n        if (!this.props.layer.editing) {\n            return (\n                <div className=\"row layer\"\n                     onClick={this.select}>\n                    <div className=\"col\">\n                        <Button className=\"visibility-btn\"\n                                tooltipData={this.props.layer.visible ? 'Hide layer' : 'Show layer'}\n                                tooltipPos=\"right\"\n                                callback={this.switchVisibility}>\n                            <i className=\"material-icons\">\n                                {this.props.layer.visible ? 'visibility' : 'visibility_off'}\n                            </i>\n                        </Button>\n                        <span className=\"title\">{this.props.layer.name}</span>\n                    </div>\n                    <div className=\"col-auto control-btns\">\n                        {this.props.selected ? <span className=\"mode\"/> : ''}\n                        <Button tooltipData=\"Navigate to layer\"\n                                tooltipPos=\"left\"\n                                callback={() => {\n                                    if (this.props.layer.data.features.length > 0) {\n                                        console.log('fly to');\n                                        this.props.map.fitBounds(turf.bbox(this.props.layer.data), { animate: true, padding: 15, duration: 500 });\n                                    }\n                                }}>\n                            <i className=\"material-icons\">\n                                location_searching\n                            </i>\n                        </Button>\n                        <Button tooltipData=\"Edit layer\"\n                                tooltipPos=\"left\"\n                                callback={() => {\n                                    this.props.editCallback(this.props.layer);\n                                }}>\n                            <i className=\"material-icons\">edit</i>\n                        </Button>\n                        <Button tooltipData=\"Edit layer\"\n                                tooltipPos=\"left\"\n                                callback={() => {\n                                    this.props.deleteCallback(this.props.layer);\n                                }}>\n                            <i className=\"material-icons\">delete</i>\n                        </Button>\n                        <Button className=\"dropdown-btn\"\n                                tooltipData=\"Download as file\"\n                                tooltipPos=\"left\"\n                                callback={(e) => {\n                                    if (!$(e.target).hasAncestor('.dropdown')) {\n                                        $('.show-dropdown').removeClass('show-dropdown');\n                                        $(e.currentTarget).toggleClass('show-dropdown');\n                                    }}}>\n                            <i className=\"fas fa-file-download\"/>\n                            <div className=\"dropdown\">\n                                Download as\n                                <div onClick={getDownloadCallback('geojson')}>GeoJSON</div>\n                                <div onClick={getDownloadCallback('kml')}>KML</div>\n                                <div onClick={getDownloadCallback('zip')}>Shapefile</div>\n                            </div>\n                        </Button>\n                    </div>\n                </div>\n            );\n        } else {\n            return (\n                <div className=\"row layer editing\"\n                     onClick={this.select}>\n                    <div className=\"col\">\n                        <Button className=\"visibility-btn\"\n                                tooltipData={this.props.layer.visible ? 'Hide layer' : 'Show layer'}\n                                tooltipPos=\"right\"\n                                callback={this.switchVisibility}>\n                            <i className=\"material-icons\">\n                                {this.props.layer.visible ? 'visibility' : 'visibility_off'}\n                            </i>\n                        </Button>\n                        <input value={this.props.layer.name} onChange={(e) => {\n                            this.props.layer.name = e.target.value;\n                            this.forceUpdate();\n                        }}/>\n                    </div>\n                    <div className=\"col-auto control-btns\">\n                        <span className=\"mode\">editing</span>\n                        <Button tooltipData=\"Save changes\"\n                                tooltipPos=\"left\"\n                                callback={() => {\n                                    this.props.saveChanges(this.props.layer);\n                                }}>\n                            <i className=\"material-icons\">done</i>\n                        </Button>\n                        <Button tooltipData=\"Cancel\"\n                                tooltipPos=\"left\"\n                                callback={() => {\n                                    this.props.discardChanges(this.props.layer);\n                                }}>\n                            <i className=\"material-icons\">close</i>\n                        </Button>\n                    </div>\n                </div>\n            )\n        }\n    }\n}\n\nconst SortableLayer = SortableElement(props => <LayerControl {...props}/>);\n\nconst LayersList = SortableContainer(props => {\n    return (\n        <div className={props.editedLayer ? \"layers container-fluid editing\" : \"layers container-fluid\"}>\n            {props.layers.map((layer, index) => (\n                <SortableLayer key={`item-${index}`} index={index} {...{\n                    ...props.layerCallbacks,\n                    map: props.map,\n                    layer: layer,\n                    selected: props.selectedLayer ? layer.id === props.selectedLayer.id : null\n                }}/>\n            ))}\n        </div>\n    );\n});\n\nclass ColorPicker extends Component {\n    state = {\n      visible: false\n    };\n\n    onChange = color => {\n        this.props.onChange({\n            target: {\n                name: this.props.name,\n                value: color.hex\n            }\n        })\n    };\n\n    render() {\n        return (\n            <div className=\"color-preview\"\n                 onClick={event => {\n                     if ($(event.target).hasClass('color-preview'))\n                         this.setState(prevState => ({visible: !prevState.visible}));\n                 }}\n                 style={{background: this.props.color ? this.props.color :\n                 'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==) left center'}}>\n                <div className={this.state.visible ? \"picker visible\" : \"picker\"}>\n                    <ChromePicker color={this.props.color} onChange={this.onChange}/>\n                </div>\n            </div>\n        );\n    }\n}\n\nclass FeaturePropertiesPopup extends Component {\n    constructor(props) {\n        super(props);\n        this.feature = null\n    }\n\n    componentDidUpdate(prevProps) {\n        if (prevProps.feature !== this.props.feature) {\n            console.log('change feature');\n            this.feature = this.props.feature;\n            this.forceUpdate();\n        }\n    }\n\n    onChange = e => {\n      this.feature.properties[e.target.name] = e.target.value;\n      this.forceUpdate();\n    };\n\n    saveChanges = () => {\n        let featureLayer = _.find(this.props.layers, layer => layer.id === this.props.feature.source);\n        console.log(featureLayer, this.feature.geometry);\n        let sourceFeature = _.find(featureLayer.data.features, feature => feature.id === this.feature.id);\n        console.log(sourceFeature);\n        sourceFeature.properties = this.feature.properties;\n        this.props.map.getSource(featureLayer.id).setData(featureLayer.data);\n    };\n\n    render() {\n        console.log(this.feature);\n        let feature = this.feature;\n        if (!feature)\n            return (\n                <div className=\"feature-properties-popup\"/>\n            );\n        let featureType = null;\n        switch(feature.geometry.type) {\n            case 'Polygon':\n                featureType = 'polygon';\n                break;\n            case 'MultiPolygon':\n                featureType = 'polygon';\n                break;\n            case 'Point':\n                featureType = 'circle';\n                break;\n            case 'MultiPoint':\n                featureType = 'circle';\n                break;\n            case 'LineString':\n                featureType = 'line';\n                break;\n            case 'MultiLineString':\n                featureType = 'line';\n                break;\n        }\n        console.log(feature.properties);\n        let properties = FEATURE_PROPERTIES[featureType];\n        let removeProp = (key) => {\n            return () => {\n                delete this.feature.properties[key];\n                this.forceUpdate();\n            };\n        };\n        return (\n            <div className={feature ? \"feature-properties-popup visible container\" : \"feature-properties-popup container\"}>\n                <Button className=\"close-btn\"\n                        callback={this.props.close}>\n                    <i className=\"material-icons\">close</i>\n                </Button>\n                {_.map(properties, (value, key) => (\n                    <div className=\"row\" key={key}>\n                        <div className=\"col\">\n                            <span>{key}</span>\n                            <i className=\"material-icons remove-btn\" onClick={removeProp(key)}>remove</i>\n                        </div>\n                        <div className=\"col\">\n                            {\n                                value === 'color' ?\n                                    <ColorPicker color={feature.properties[key] ? feature.properties[key] : ''}\n                                                 name={key}\n                                                 onChange={this.onChange}/> :\n                                    <input name={key}\n                                           type={value}\n                                           value={feature.properties[key] ? feature.properties[key] : ''}\n                                           onChange={this.onChange}/>\n                            }\n                        </div>\n                    </div>\n                ))}\n                {_.reduce(feature.properties, (result, value, key) => {\n                    if (_.indexOf(_.keysIn(properties), key) === -1)\n                        result.push(\n                            <div className=\"row\" key={key}>\n                                <div className=\"col\">\n                                    <span>{key}</span>\n                                    <i className=\"material-icons remove-btn\" onClick={removeProp(key)}>remove</i>\n                                </div>\n                                <div className=\"col\">\n                                    <input name={key}\n                                           type=\"text\"\n                                           value={value}\n                                           onChange={this.onChange}/>\n                                </div>\n                            </div>\n                        );\n                    return result;\n                }, [])}\n                <div className=\"row d-flex justify-content-center\">\n                    {/*<i className=\"material-icons\">add_circle</i>*/}\n                    <div className=\"col-auto\">\n                        <div className=\"text-btn\" onClick={this.saveChanges}>\n                            Save\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nclass App extends Component {\n    constructor(props) {\n        super(props);\n        this.layers = [];\n        this.layersIndex = 0;\n        this.map = null;\n        this.draw = null;\n        this.downloadFile = null;\n        this.selectedLayer = null;\n        this.editedLayer = null;\n        this.selectedFeature = null;\n    }\n\n    componentDidMount() {\n        mapboxgl.accessToken = 'pk.eyJ1IjoiYmJhbGJhdHJvc3MiLCJhIjoiY2pub2RwanMwMmdoZjNrb3NuMzhvZXAzOCJ9.F8VzBUbUv6_NOVZgcWrhqQ';\n        let map = new mapboxgl.Map({\n            container: 'map',\n            style: 'mapbox://styles/mapbox/streets-v9',\n            // maxBounds: [\n            //     [-180, -90], // Southwest coordinates\n            //     [180, 90]  // Northeast coordinates\n            // ]\n        });\n        map.addControl(new mapboxgl.NavigationControl());\n        // let draw = new MapboxDraw();\n        // map.addControl(draw);\n        map.on('load', function () {\n            // map.addLayer({\n            //     'id': 'wms-test-layer',\n            //     'type': 'raster',\n            //     'source': {\n            //         'type': 'raster',\n            //         'tiles': [\n            //             'https://services.sentinel-hub.com/ogc/wms/b7b5e3ef-5a40-4e2a-9fd3-75ca2b81cb32?showLogo=false&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&srs=EPSG:3857&transparent=true&width=256&height=256&layers=1_NATURAL_COL0R&'\n            //             // 'https://geodata.state.nj.us/imagerywms/Natural2015?bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&srs=EPSG:3857&transparent=true&width=256&height=256&layers=Natural2015'\n            //         ],\n            //         'tileSize': 256\n            //     },\n            //     'paint': {}\n            // }, 'aeroway-taxiway');\n        });\n        map.on('contextmenu', e => {\n            let layersIds = this.layers.map(layer => layer.id);\n            let feature = this.map.queryRenderedFeatures(e.point, {\n                layers: _.reduce(this.map.getStyle().layers, (result, layer) => {\n                    if (_.indexOf(layersIds, layer.source) !== -1)\n                        result.push(layer.id);\n                    return result;\n                }, [])\n            })[0];\n            if (!feature)\n                return;\n            map.getCanvas().style.cursor = 'pointer';\n            this.selectedFeature = feature;\n            this.forceUpdate();\n        });\n        this.map = map;\n        $('.controls').click(function(e) {\n            if (!($(e.target).hasAncestor('.dropdown-btn') || $(e.target).hasClass('dropdown-btn'))) {\n                $('.show-dropdown').removeClass('show-dropdown');\n            }\n        });\n    }\n\n    setLayerVisibility = (layer, visibility) => {\n        console.log(layer, visibility);\n        if (!visibility) {\n            this.map.setLayoutProperty(layer.id+'fill', 'visibility', 'none');\n            this.map.setLayoutProperty(layer.id+'fill-stroke', 'visibility', 'none');\n            this.map.setLayoutProperty(layer.id+'circle', 'visibility', 'none');\n            this.map.setLayoutProperty(layer.id+'line', 'visibility', 'none');\n        } else {\n            this.map.setLayoutProperty(layer.id+'fill', 'visibility', 'visible');\n            this.map.setLayoutProperty(layer.id+'fill-stroke', 'visibility', 'visible');\n            this.map.setLayoutProperty(layer.id+'circle', 'visibility', 'visible');\n            this.map.setLayoutProperty(layer.id+'line', 'visibility', 'visible');\n        }\n    };\n\n    removeLayer = (layer) => {\n        this.map.removeLayer(layer.id+'fill');\n        this.map.removeLayer(layer.id+'fill-stroke');\n        this.map.removeLayer(layer.id+'circle');\n        this.map.removeLayer(layer.id+'line');\n        this.map.removeSource(layer.id);\n        _.remove(this.layers, l => l.id === layer.id);\n        this.forceUpdate();\n    };\n\n    editLayer = (layer) => {\n        this.editedLayer = this.selectedLayer = _.cloneDeep(layer);\n        layer.editing = true;\n        this.selectedLayer = layer;\n        if (this.draw) {\n            this.draw.set(layer.data);\n        }\n        else {\n            this.draw = new MapboxDraw();\n            this.map.addControl(this.draw);\n            this.map.on('draw.create', this.updateLayer);\n            this.map.on('draw.update', this.updateLayer);\n            this.draw.add(layer.data);\n        }\n        this.setLayerVisibility(layer, false);\n        this.forceUpdate();\n    };\n\n    updateLayer = () => {\n        this.selectedLayer.data = this.draw.getAll();\n        this.forceUpdate();\n    };\n\n    saveChanges = (layer) => {\n        layer.editing = false;\n        this.map.getSource(layer.id).setData(this.assignIds(layer.data));\n        this.map.off('draw.create', this.updateLayer);\n        this.map.off('draw.update', this.updateLayer);\n        this.map.removeControl(this.draw);\n        this.draw = null;\n        this.editedLayer = null;\n        this.setLayerVisibility(layer, true);\n        this.forceUpdate();\n    };\n\n    assignIds = (data) => {\n        _.each(data.features, (feature, i) => {\n            feature.id = i;\n        });\n        console.log(data);\n        return data;\n    };\n\n    discardChanges = (layer) => {\n        layer.editing = false;\n        layer.name = this.editedLayer.name;\n        layer.data = this.editedLayer.data;\n        this.map.off('draw.create', this.updateLayer);\n        this.map.off('draw.update', this.updateLayer);\n        this.map.removeControl(this.draw);\n        this.draw = null;\n        this.editedLayer = null;\n        this.setLayerVisibility(layer, true);\n        this.forceUpdate();\n    };\n\n    addLayer = (geojson, name) => {\n        this.assignIds(geojson);\n        let id = this.layersIndex.toString();\n        this.map.addSource(id, {\n            \"type\": \"geojson\",\n            \"data\": geojson\n            // \"generateId\": true\n        });\n        this.map.addLayer({\n            \"id\": id+'fill',\n            \"type\": \"fill\",\n            \"source\": id,\n            \"paint\": {\n                'fill-color': ['coalesce', ['get', 'fill'], ['get', 'fill-color'], '#088'],\n                'fill-opacity': ['coalesce', ['get', 'fill-opacity'], 0.7]\n            },\n            \"filter\": [\"in\", \"$type\", \"Polygon\"]\n        });\n        this.map.addLayer({\n            \"id\": id+'fill-stroke',\n            \"type\": \"line\",\n            \"source\": id,\n            \"paint\": {\n                \"line-color\": ['coalesce', ['get', 'stroke'], ['get', 'stroke-color']],\n                \"line-width\": ['coalesce', ['get', 'stroke-width'], 0],\n                'line-opacity': ['coalesce', ['get', 'stroke-opacity'], 0]\n            },\n            \"filter\": [\"in\", \"$type\", \"Polygon\"]\n        });\n        this.map.addLayer({\n            \"id\": id+'circle',\n            \"type\": \"circle\",\n            \"source\": id,\n            \"paint\": {\n                \"circle-radius\": ['coalesce', ['get', 'circle-radius'], 3],\n                \"circle-color\": ['coalesce', ['get', 'circle-color'], '#088'],\n                \"circle-opacity\": ['coalesce', ['get', 'circle-opacity'], 1]\n            },\n            \"filter\": [\"in\", \"$type\", \"Point\"]\n        });\n        this.map.addLayer({\n            \"id\": id+'line',\n            \"type\": \"line\",\n            \"source\": id,\n            \"layout\": {\n                \"line-join\": \"round\",\n                \"line-cap\": \"round\"\n            },\n            \"paint\": {\n                \"line-width\": 2,\n                \"line-color\": '#088'\n            },\n            \"filter\": [\"in\", \"$type\", \"LineString\"]\n        });\n        this.layers.push({name: name, id: id, data: geojson, visible: true, editing: false});\n        this.layersIndex++;\n        this.forceUpdate();\n    };\n\n    fileDownload = (layer, extension) => {\n        let content;\n        let data;\n        if (extension === 'geojson') {\n            content = JSON.stringify(layer.data);\n            data = new Blob([content], {type: 'application/json'});\n        } else if (extension === 'zip') {\n            content = shpwrite.zip(layer.data);\n            let link = document.getElementById('download-link');\n            link.download = layer.name + '.' + extension;\n            link.href = 'data:application/zip;base64,' + content;\n            let event = new MouseEvent('click');\n            link.dispatchEvent(event);\n            return;\n        } else if (extension === 'kml') {\n            content = tokml(layer.data);\n            data = new Blob([content], {type: 'text/xml'});\n        }\n        // If we are replacing a previously generated file we need to\n        // manually revoke the object URL to avoid memory leaks.\n        if (this.downloadFile !== null) {\n            window.URL.revokeObjectURL(this.downloadFile);\n        }\n\n        this.downloadFile = window.URL.createObjectURL(data);\n\n        let link = document.getElementById('download-link');\n        link.download = layer.name + '.' + extension;\n        link.href = this.downloadFile;\n\n        // wait for the link to be added to the document\n        window.requestAnimationFrame(function () {\n            let event = new MouseEvent('click');\n            link.dispatchEvent(event);\n        });\n    };\n\n    fileUpload = (event) => {\n        let input = event.target;\n        for (let i = 0, file; file = input.files[i]; i++) {\n            let extension = file.name.split('.').pop();\n            if (extension === 'zip') {\n                let reader = new FileReader();\n                reader.onload = (e) => {\n                    // console.log('read file', e.target.result);\n                    // let data = new Blob([e.target.result], {type: 'application/zip'});\n                    // let reader = new FileReader();\n                    // reader.onload = (e) => {\n                    //     console.log('from blob', e.target.result);\n                    //     shp(e.target.result).then((geojson) => {\n                    //         console.log(geojson);\n                    //     }).catch(() => {\n                    //         console.log('error');\n                    //     });\n                    // };\n                    // reader.readAsArrayBuffer(data);\n                    shp(e.target.result).then((geojson) => {\n                        this.addLayer(geojson, file.name.substr(0, file.name.length - extension.length - 1));\n                    });\n                };\n                reader.readAsArrayBuffer(file);\n            }\n            else if (extension === 'kml') {\n                let reader = new FileReader();\n                reader.onload = (e) => {\n                    let dom = (new DOMParser()).parseFromString(e.target.result, 'text/xml');\n                    let geojson = toGeoJSON.kml(dom);\n                    this.addLayer(geojson, file.name.substr(0, file.name.length - extension.length - 1));\n                };\n                reader.readAsText(file);\n            }\n            else if (extension === 'geojson') {\n                let reader = new FileReader();\n                reader.onload = (e) => {\n                    let geojson = JSON.parse(e.target.result);\n                    this.addLayer(geojson, file.name.substr(0, file.name.length - extension.length - 1));\n                };\n                reader.readAsText(file);\n            }\n        }\n    };\n\n    selectLayer = (layer) => {\n        console.log(layer.data);\n        this.selectedLayer = layer;\n        this.forceUpdate();\n    };\n\n    onSortEnd = ({oldIndex, newIndex}) => {\n        let layer = this.layers[oldIndex].id;\n        let beforeLayer = newIndex === this.layers.length - 1 ? undefined : this.layers[newIndex].id + 'fill';\n        console.log(oldIndex, newIndex, this.layers[oldIndex], this.layers[newIndex]);\n        this.map.moveLayer(layer + 'fill', beforeLayer);\n        this.map.moveLayer(layer + 'fill-stroke', beforeLayer);\n        this.map.moveLayer(layer + 'circle', beforeLayer);\n        this.map.moveLayer(layer + 'line', beforeLayer);\n        this.layers = arrayMove(this.layers, oldIndex, newIndex);\n        this.forceUpdate();\n    };\n\n    closePopup = () => {\n        this.selectedFeature = null;\n        this.forceUpdate();\n    };\n\n    render() {\n        return (\n            <div className=\"container-fluid\">\n                <div className=\"row\">\n                    <div id=\"map\" className=\"col-8\">\n                        <FeaturePropertiesPopup feature={this.selectedFeature}\n                                                map={this.map}\n                                                layers={this.layers}\n                                                ref={\"featurePopup\"}\n                                                close={this.closePopup}/>\n                    </div>\n                    <div className=\"col-4 controls\">\n                        <div className=\"header\">\n                            <span className=\"title\">Preview</span>\n                            <div className=\"preview-box\"\n                                 dangerouslySetInnerHTML={\n                                     {__html: this.selectedLayer ? geojson2svg(this.selectedLayer.data).render() : ''}}>\n                            </div>\n                        </div>\n                        <div className=\"header\">\n                            <span className=\"title\">Layers</span>\n                            <input name=\"file-input\"\n                                   id=\"file-input\"\n                                   onChange={this.fileUpload}\n                                   type=\"file\"\n                                   hidden/>\n                            <a id=\"download-link\" href=\"./\">Download</a>\n                            <Button tooltipData=\"Add from file\"\n                                    tooltipPos=\"down\"\n                                    callback={() => {\n                                        $('#file-input').click();\n                                    }}>\n                                <i className=\"fas fa-file-upload\"/>\n                            </Button>\n                            <Button tooltipData=\"Add new empty layer\"\n                                    tooltipPos=\"down\"\n                                    callback={() => {\n                                        this.addLayer({\n                                            \"type\": \"FeatureCollection\",\n                                            \"features\": []\n                                        }, 'New layer');\n                                    }}>\n                                <i className=\"material-icons add-layer-btn\">library_add</i>\n                            </Button>\n                        </div>\n                        <LayersList pressDelay={400}\n                                    map={this.map}\n                                    layers={this.layers}\n                                    editedLayer={this.editedLayer}\n                                    selectedLayer={this.selectedLayer}\n                                    layerCallbacks={{\n                                        downloadCallback: this.fileDownload,\n                                        editCallback: this.editLayer,\n                                        selectCallback:this.selectLayer,\n                                        setVisibility: this.setLayerVisibility,\n                                        saveChanges: this.saveChanges,\n                                        discardChanges: this.discardChanges,\n                                        deleteCallback: this.removeLayer,\n                                    }}\n                                    onSortEnd={this.onSortEnd}/>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}